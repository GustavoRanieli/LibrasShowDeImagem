const config={video:{width:640,height:480,fps:30}},landmarkColors={thumb:"white",indexFinger:"white",middleFinger:"white",ringFinger:"white",pinky:"white",palmBase:"white"},gestureStrings={libryA:"A",libryB:"B",libryC:"C",libryD:"D",libryE:"E",libryF:"F",libryG:"G",libryH:"H",libryI:"I",libryJ:"J",libryK:"K",libryL:"L",libryM:"M",libryN:"N",libryO:"O",libryP:"P",libryQ:"Q",libryR:"R",libryS:"S",libryT:"T",libryU:"U",libryV:"V",libryW:"W",libryX:"X",libryY:"Y",libryZ:"Z"};let words="";const inputLayer=document.querySelector("#inputLayer");function sleep(r){return new Promise(e=>setTimeout(e,r))}async function main(){await sleep(2e3);let e=document.querySelector("#progressBar");const n=document.querySelector("#pose-video");const u=document.querySelector("#pose-canvas").getContext("2d"),a=document.querySelector("#pose-result");e.setAttribute("class","progress");var r=[fp.Gestures.LibryAGesture,fp.Gestures.LibryBGesture,fp.Gestures.LibryCGesture,fp.Gestures.LibryDGesture,fp.Gestures.LibryEGesture,fp.Gestures.LibryFGesture,fp.Gestures.LibryGGesture,fp.Gestures.LibryHGesture,fp.Gestures.LibryIGesture,fp.Gestures.LibryJGesture,fp.Gestures.LibryKGesture,fp.Gestures.LibryLGesture,fp.Gestures.LibryMGesture,fp.Gestures.LibryNGesture,fp.Gestures.LibryOGesture,fp.Gestures.LibryPGesture,fp.Gestures.LibryQGesture,fp.Gestures.LibryRGesture,fp.Gestures.LibrySGesture,fp.Gestures.LibryTGesture,fp.Gestures.LibryUGesture,fp.Gestures.LibryVGesture,fp.Gestures.LibryWGesture,fp.Gestures.LibryXGesture,fp.Gestures.LibryYGesture,fp.Gestures.LibryZGesture];const l=new fp.GestureEstimator(r),y=await handpose.load(),d=(console.log("Gestos Carregados"),e.style.width="25%",async()=>{u.clearRect(0,0,config.video.width,config.video.height),a.innerText="";var r=await y.estimateHands(n,!0);for(let e=0;e<r.length;e++){for(var t in r[e].annotations)for(var s of r[e].annotations[t])drawPoint(u,s[0],s[1],3,landmarkColors[t]);var i=l.estimate(r[e].landmarks,9);if(0<i.gestures.length){const n=document.querySelector("#pose-video");var i=i.gestures.reduce((e,r)=>e.score>r.score?e:r),o=document.querySelector("#inputLayer");return n.style.border="5px solid green",await sleep(2500),a.innerText=gestureStrings[i.name],0<a.innerText.length&&(o.value=words+[...i.name].slice(5)),n.style.border="transparent",void(words=o.value)}}setTimeout(()=>{d()},1e3/config.video.fps)});e.style.width="50%",d(),console.log("Iniciando Captura"),setTimeout(()=>{e.setAttribute("class","None")},2200)}async function initCamera(e,r,t){t={audio:!1,video:{facingMode:"user",width:e,height:r,frameRate:{max:t}}};const s=document.querySelector("#pose-video");s.width=e,s.height=r;e=await navigator.mediaDevices.getUserMedia(t);return s.srcObject=e,new Promise(e=>{s.onloadedmetadata=()=>{e(s)}})}function drawPoint(e,r,t,s,i){e.beginPath(),e.arc(r,t,s,0,2*Math.PI),e.fillStyle=i,e.fill()}window.addEventListener("DOMContentLoaded",()=>{initCamera(config.video.width,config.video.height,config.video.fps).then(e=>{e.play(),e.addEventListener("loadeddata",e=>{console.log("Camera is ready")})});var e=document.querySelector("#pose-canvas");e.width=config.video.width,e.height=config.video.height,console.log("Canvas initialized")}),main();